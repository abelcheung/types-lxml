- case: included_files
  skip: true
  files: &INC
    - path: errorinc.py
      content: |
        from lxml.etree import (
          _LogEntry,
          _ListErrorLog,
          _RotatingErrorLog,
          PyErrorLog,
        )
        listlog: _ListErrorLog
        pylog: PyErrorLog
        entry: _LogEntry
        rotlog: _RotatingErrorLog
  main: null

- case: rotatinglog_init
  main: |
    from lxml.etree import _RotatingErrorLog
    log = _RotatingErrorLog(30)
    reveal_type(log)  # NR: .+ "[\w\.]+\._RotatingErrorLog"$
    _ = _RotatingErrorLog()  # ER: .+ \[call-arg]$
    _ = _RotatingErrorLog(None)  # ER: .+ \[arg-type]$
    _ = _RotatingErrorLog(30, None)  # ER: .+ \[call-arg]$

- case: rotatinglog_behaves_like_listlog
  files: *INC
  main: |
    from errorinc import rotlog, entry
    reveal_type(rotlog[0])  # NR: .+ "[\w\.]+\._LogEntry"
    reveal_type(len(rotlog))  # NR: .+ "[\w\.]+\.int"
    reveal_type(rotlog[0] in rotlog)  # NR: .+ "[\w\.]+\.bool"
    for e in rotlog:
      reveal_type(e)  # NR: .+ "[\w\.]+\._LogEntry"
    reveal_type(rotlog.filter_domains([1,2]))  # NR: .+ "[\w\.]+\._ListErrorLog"$
    reveal_type(rotlog.filter_from_level(1))  # NR: .+ "[\w\.]+\._ListErrorLog"$
    rotlog.clear()
    rotlog.copy()
    rotlog.receive(entry)

- case: pylog_init
  main: |
    from logging import Logger
    from lxml.etree import PyErrorLog
    s: str
    logger: Logger
    _ = PyErrorLog()
    _ = PyErrorLog(logger_name=s)
    _ = PyErrorLog(s, logger=logger)
    _ = PyErrorLog(None)
    _ = PyErrorLog(logger_name=1)  # ER: .+ \[arg-type]$
    _ = PyErrorLog(None, 'logger')  # ER: .+ \[arg-type]$
    _ = PyErrorLog(None, logger, None)  # ER: .+ \[call-arg]$

- case: pylog_props_and_methods
  files: *INC
  main: |
    from errorinc import pylog, entry
    s: str
    reveal_type(pylog.level_map)  # NR: .+ "[\w\.]+\[[\w\.]+\.ErrorLevels, [\w\.]+\.int]"$
    reveal_type(pylog.last_error)  # NR: .+ "Union\[[\w\.]+\._LogEntry, None]"
    pylog.receive(entry)
    pylog.log(entry, s)

- case: module_funcs
  files: *INC
  main: |
    from lxml.etree import clear_error_log, use_global_python_log
    from errorinc import pylog
    clear_error_log()
    clear_error_log(None)  # ER: .+ \[call-arg]$
    use_global_python_log(pylog)
    use_global_python_log()  #  ER: .+ \[call-arg]$

