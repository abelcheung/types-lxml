name: Type checker compatibility tests

on:
  - workflow_dispatch

jobs:
  mypy_compat:
    strategy:
      fail-fast: false
      matrix:
        myver:
          - 1.11.0
          - 1.11.1
          - 1.11.2
          - 1.12.0
          - 1.12.1
          - 1.13.0
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4

      - uses: astral-sh/setup-uv@v3
        with:
          version: '0.4.27'
          enable-cache: true
          cache-dependency-glob: |
            ./pyproject.toml

      - name: Install prerequisites
        run: |
          uv python install 3.10
          uv venv --python-preference only-managed
          uv pip install -r pyproject.toml
          uv pip install 'mypy == ${{ matrix.myver }}'

      - name: Perform type check
        run: |
          source .venv/bin/activate
          mypy lxml-stubs

  pyright_compat:
    strategy:
      fail-fast: false
      matrix:
        prver:
          - 1.1.386
          - 1.1.387
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4

      - uses: astral-sh/setup-uv@v3
        with:
          version: '0.4.27'
          enable-cache: true
          cache-dependency-glob: |
            ./pyproject.toml

      - name: Install prerequisites
        run: |
          uv python install 3.10
          uv venv --python-preference only-managed
          uv pip install -r pyproject.toml

      - uses: jakebailey/pyright-action@v2
        with:
          version: ${{ matrix.prver }}
          python-path: .venv/bin/python
